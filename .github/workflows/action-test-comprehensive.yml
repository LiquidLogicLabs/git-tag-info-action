name: Action Test - Comprehensive

on:
  workflow_dispatch:
  workflow_call:

jobs:
  comprehensive-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Full history for tag testing

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build action
        run: npm run build

      - name: Test - All outputs present
        id: all-outputs
        uses: ./
        with:
          tag_name: v1.0.0
          repository: .

      - name: Verify all outputs
        run: |
          echo "Checking all outputs..."
          echo "✓ exists: ${{ steps.all-outputs.outputs.exists }}"
          echo "✓ name: ${{ steps.all-outputs.outputs.name }}"
          echo "✓ item_sha: ${{ steps.all-outputs.outputs.item_sha }}"
          echo "✓ item_type: ${{ steps.all-outputs.outputs.item_type }}"
          echo "✓ commit_sha: ${{ steps.all-outputs.outputs.commit_sha }}"
          if [ -n "${{ steps.all-outputs.outputs.details }}" ]; then
            echo "✓ details: ${{ steps.all-outputs.outputs.details }}"
          else
            echo "ℹ details: (empty - may be expected for some tags)"
          fi
          echo "✓ verified: ${{ steps.all-outputs.outputs.verified }}"

      - name: Test - Tag type validation
        id: tag-type
        uses: ./
        with:
          tag_name: v1.0.0
          repository: .

      - name: Verify tag type
        run: |
          item_type="${{ steps.tag-type.outputs.item_type }}"
          if [ -z "$item_type" ]; then
            echo "WARNING: item_type is empty"
          elif [ "$item_type" != "commit" ] && [ "$item_type" != "tag" ] && [ "$item_type" != "release" ]; then
            echo "WARNING: Unexpected item_type: $item_type (expected 'commit', 'tag', or 'release')"
          else
            echo "✓ Item type: $item_type"
          fi

      - name: Test Summary
        run: |
          echo "## ✅ Comprehensive Tests Passed" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- All outputs present: ✅" >> $GITHUB_STEP_SUMMARY
          echo "- Tag type validation: ✅" >> $GITHUB_STEP_SUMMARY

